function getUser(n,t){try{db.collection("users",function(i,r){i&&(console.error("#2#",i.toString()),t(null)),r.findOne({name:n},function(n,i){n&&(console.error("#3#",n.toString()),t(null)),t(i)})})}catch(i){console.error(i.toString()),t(null)}}function addUser(n,t){try{db.collection("users",function(i,r){if(i)throw i;r.insert(n,{safe:!0},function(n,i){if(n)throw n;t(i)})})}catch(i){console.error(i.toString()),t(null)}}function addPost(n,t){db.collection("posts",function(i,r){i&&console.error("addPost error"),r.insert(n,{safe:!0},function(n,i){n&&console.error("addPost collection insert error",n.message),t(i)})})}function getPost(n,t){db.collection("posts",function(i,r){i&&console.error("getPost err"),r.find(n?{user:n}:{}).sort({time:-1}).toArray(function(n,i){n&&console.error(n.message);var r=[];i.forEach(function(n){r.push({user:n.user,post:n.post,time:n.time})}),t(r)})})}var mongodb=require("mongodb"),server=new mongodb.Server("localhost",27017,{auto_reconnect:!0}),db=new mongodb.Db("cnriabook",server,{w:1});db.open(function(n,t){if(n){console.error("db.open error",n.message);return}console.log("db.users.ensureIndex(name)"),t.collection("users",{safe:!0},function(n,i){if(n)return console.error("db.connection error"),t.close();i.ensureIndex("name",{unique:!0},function(n){n&&(console.error("collection.ensureIndex"),t.close())})}),t.collection("posts",{safe:!0},function(t,i){n&&console.error("db.connection error"),i.ensureIndex("user",{},function(n){n&&console.error("connection.ensureIndex error")})})}),exports.getUser=getUser,exports.addUser=addUser,exports.addPost=addPost,exports.getPost=getPost